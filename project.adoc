= Проект BugTracker бот для телеграм

== Класс Task


=== Правила, как могут переходить статусы в задачах

- Нельзя переходить в тот-же статус, что и сейчас.
- Нельзя перепрыгивать через Done: из активного сразу в архив и наоборот.

=== Правила, задачи с какими статусами можно добавлять

К задаче можно добавить статус с таким-же или более высоким статусом:
- к активной - любую
- к выполненой - выполненую или архивную
- к архивной - только другую архивную

=== TODO

. Сделать поиск по ID задачи



== Интерфейс Datastore

=== Описание интерфейса

У нас есть один метод - get, который принимает лист аргументов (?) и возвращает строку.

Какие именно данные нам нужно получать:

- JSON с списком задач по имени пользователя (можно еще разбить на задачи от корня)
- Элементы конфигурации
- И тд, всякое такое.

Как это работает:

Мы формируем запрос в БД (файлы, redis, всё, что угодно) в виде `"arg1:arg2:arg3:...:argn"`, и делаем запрос к базе (ключ - значение).




== Интерфейс бота



.Список от корня, команда */list*
----
*Tasks:*
Задача 1 /list1
Задача 2 /list2

Buttons:
/prev /new /next
----

.Список подзадач, команда /list1
----
*Задача 1* /detail1
[v] Придумать тему /done11 /list11
[ ] Придумать ещё что-то /done12 /list12

Buttons:
/prev /new1 /next
----

.Детали задачи, команда */detail123*
----
*сделать задачу* /edit1
Subject: сделать задачу
Description: сделать какую-то задачу.
State: active /done
Remind: 12 августа 8:00

Buttons:
/edit1 /done1 /reminder1
----

.Список напоминаний, команда /reminders
----
*Reminders:*
Задача 1 - 12 августа 8:00 /reminder1
Задача 2 - 15 августа 9:00 /reminder2
----

.Поиск задачи по названию, команда /find
----
*Find:*
Задача 1 /list1
Задача 2 /list2
----



=== Список доступных команд

|====
| Команда           | Параметры
| `/list[currentID]`       | Если без параметров - список задач от корня. Иначе список подзадач задачи с номером currentID
| `/new[currentID] subj`   | Новая задача (или подзадача). Может быть сразу задана тема
| `/detail{currentID}`     | Подробный вывод задачи с номером currentID
| `/done{currentID}`       | Установить статус для задачи в выполнено
| `/archive{currentID}`    | Установить статус для задачи в архивировано
| `/edit{currentID}`       | Переход в режим редактирования задачи
|  |
|====


=== Подумаем над таблицей состояний


.Состояния
====
*Какие есть вообще состояния (собственно экраны):*

|====
| Состояние                                     | Класс

| Просмотр подзадач конкретной задачи или корня | ListState
| Просмотр деталей задачи                       | DetailState
| Редактирование задачи                         | EditState
| Создание новой задачи (?)                     | NewTaskState
| Редактирование напоминания                    | RemindState
| Просмотр результатов поиска                   | FindState
|====
====

.Действия
====
*Какие есть действия (в скобках параметры):*

|====
| Действие                                          | Команда              | Откуда может быть вызвано

| Переход к списку задач                            | /main                | Из любого
| Переход к списку подзадач задачи                  | /list{id}            |
| Переход к деталям задачи                          | /detail{id}          |
| Редактировать задачу                              | /edit{id}            |
| Создать новую задачу                              | /new{id}             |
| Открыть редактирование напоминания задачи         | /reminder{id}        |
| Переход к списку напоминаний                      | /reminders           |
| Пометить задачу сделаной                          | /done{id}            |
| Пометить задачу активной                          | /undone{id}          |
| Архивировать задачу                               | /archive{id}         |
| Разархивировать задачу                            | /unarchive{id}       |

| Выполнить поиск (строка для поиска)               | /find {text}         |
| Показывать или скрывать выполненые задачи         | /showDone /hideDone  |
|====
====

.Статус
====
*Что именно нам нужно будет хранить*

. Наше текущее положение в списке задач (текущая задача или корень)
. Показывать или нет выполненые задачи
====


[IMPORTANT]
====
Подумать про это:

* Как и когда будут отображаться архивные задачи?
====

== Что делать с сейвером?

. У нас есть переменная с функцией saver, которая должна сохранять данные на диск для определенного пользователя.
. При загрузке из JSON эта переменная равна нулю.

Что делать?

Варианты:

. Найти корень, где эта функция установлена.
+
Минус данного решения в том, что тогда нужно будет пробрасывать родителя в потомков.
. Автоматически устанавливать эту функцию при загрузке из JSON
. Устанавливать для данной задачи и для всех подзадач.













== Всякая другая ерунда


Как будем разбирать команду:

. У нас есть интерфейс Command в котором будет определено чтот типа apply() (ну или exec)
. У нас есть фабрика объектов CommandFabric которая из заданной строки создаёт команду с параметрами.
. Мы создаём нашу команду посредством фабрики и выполняем её.
. На выходе команды можем получать либо строку, либо лист строк, который уже объединяется в строку.

Что нам нужно для выполнения команд:

. Можно просто передавать текущую сессию. В ней есть и датастор, и пользователь, и текущее состояние.
. Нужно ли мне состояние, или же всё  будет передаваться в параметрах команд? Думаю состояние необходимо чтобы строить задачи. Так, для того, чтобы нам создать новую задачу, нам нужно получить имя и описание.


Так, как будет идти взаимодействие:

. Мы можем получить список задач командой list. Выводится список подзадач в текущей задаче (либо корня)




3. Создание новой задачи

* Нажимаем кнопку создать
* currentID задачи устанавливается в время, когда задача создавалась
* Родителя задачи мы тоже знаем
* У нас спрашивается тема задачи, вводим
* У нас спрашивают её описание, вводим (надо ли? А если без описания, как пропустить этот шаг? Специальная команда на клавиатуре или ссылкой /skip)
* Нам выводится то, что мы ввели, подтверждает командой /ok










